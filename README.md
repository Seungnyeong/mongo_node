## 몽고디비 팁

부모문서를 자식 문서에 최초에 내장하는 방법이 있음. 관계형일 때 유용 (denormalize) 읽기가 빠르지만,
CUD 작업이 늘어난다.

내장 할것인지 관계할 것인지

개별적으로 읽을 때도 있다? 관계
내장하려는 문서가 자주 바뀐다? 관계
같이 불러올떄가 많다? 내장
읽기 비중이 CUD 비중보다 더 높다? 내장

복합해서 쓸 떄도 있음.

1:N

n < 100 내장
100 < N < 1000 부분(id만) 내장 해당 id를 가지고 populate() 하자
1000 < n 관계 하나의 문서에 16MB 정도의 제한을 가지고 있다.
N을 다양한 조건으로 탐색한다. 관계

인덱스를 걸어 탐색 속도를 높이자 (복합적으로 걸수 있다. 복합키)

복합키 걸 때, 인덱스 순서도 중요함.
정렬 등을 반대로 하게 되면 컬렉션 스캔을 하게 됨. 대칭이 맞으면 가능함. \* -1 했을떄 1이 나오면 된다고 보면됨.

좋은 인덱스란 무엇인가?
selectivity가 좋아야 함. 다양성이 높으면, 더 빨리 검색할 수 있다.
selectivity를 고려하여 인덱스를 지정해야 한다.

복합키 인 경우가 더 우선순위로 둔다.

무조건 인덱스를 만들어주면 되지 않냐? 인덱스를 많이 만들면 생기는 문제

1. 데이터 공간을 차지한다. 인덱스를 몽고디비 메모리에 올리게 된다.
2. CRUD 에서 READ는 빨라지지만, CUD(쓰기 속도)는 느려진다. 데이터를 생성할 때 데이터만 생성하는 것이 아니라 인덱스도 생성해야 하기 때문이다. 맞는 위치에 찾아서 하는 것이 비싸다.

자주 쓰는 쿼리를 위주로 explain하여 테스트하여 인덱스를 설정하는 것이 좋다. 무조건 다 때려서 넣지 말고

text.index 생성하기 텍스트 인덱스는 컬렉션에 하나만 설정할 수 있으므로, 여러개를 하기 위해서는 복합키로 걸어야 한다. (순서는 중요하지 않음)
단어들의 키워드를 분리해서 토크나이제이션 하여 한다. 중복 되는 것도 제거, 무의미한 단어들을 제외하고 검색에 쓰일만한 단어들을 가지고 인덱스를 걸게 된다.

## ACID Transaction 이란 무엇인가?

concurrent 문제 : 동시에 같은 문서를 수정 요청할 때 생기는 문제
환경을 아이솔레이트 처리하여, LOCK을 걸어 기다렸다가 다시 트랜잭션을 태운다
